!function(g,t){"use strict";var l="ht",y=l+".layout.",G=g[l]||module.parent.exports.ht,J=G.List,k=G.DataModel,z=G.Node,q=G.Edge,U=G.Group,_=Math,L=_.sqrt,o=_.random,D=_.max,A=_.min,B=function(b){return b*b};G.Default.getInternal().addMSMap({ms_force:function(f){f._interval=50,f._stepCount=10,f._motionLimit=.01,f._edgeRepulsion=.65,f._nodeRepulsion=.65,f._damper=1,f._maxMotion=0,f._motionRatio=0,f.init=function(j){var A=this;j instanceof k?A.dm=j:A.gv=j,A._nodeMap={},A._nodes=new J,A._edges=new J},f.start=function(){var n=this,D=n.gv;if(!n._timer){var U=n.cdm=D?D.dm():n.dm;U.mm(n.handleDataModelChange,n),U.md(n.handleDataPropertyChange,n),D&&D.mp(n.handleGV,n),U.each(function(T){if(n.isVisible(T)&&n.isLayoutable(T)&&T instanceof z)if(n instanceof d){var Z=T.p3();T.p3([Z[0]+o(),Z[1]+o(),Z[2]+o()])}else Z=T.p(),T.p(Z.x+o(),Z.y+o())}),n._timer=setInterval(function(){n.relax()},n._interval),n._damper=1}},f.stop=function(){var I=this;I._timer&&(I.cdm.umm(I.handleDataModelChange,I),I.cdm.umd(I.handleDataPropertyChange,I),I.gv&&I.gv.ump(I.handleGV,I),clearInterval(I._timer),delete I._timer,delete I.cdm)},f.handleGV=function(S){var w=this;if("dataModel"===S.property){var V=S.oldValue,T=S.newValue;V&&(V.umm(w.handleDataModelChange,w),V.umd(w.handleDataPropertyChange,w)),this.cdm=T,T.mm(w.handleDataModelChange,w),T.md(w.handleDataPropertyChange,w)}},f.relax=function(){var M=this;if(!(M._damper<.1&&M._maxMotion<M._motionLimit)){this.cdm.each(function(v){M.isVisible(v)&&(v instanceof q?M.addEdge(v):v instanceof z&&M.addNode(v))});for(var H,c,E=0,x=M._edges,d=M._nodes,T=d.size();E<M._stepCount;E++){for(x.each(M.relaxEdge,M),H=0;T>H;H++)for(c=0;T>c;c++)M.relaxNode(d.get(H),d.get(c));M.moveNode()}M._isAdjusting=1,d.each(function(S){S.fix||(S.p?S.v.p3(S.p):S.v.p(S.x,S.y))}),delete M._isAdjusting,M._nodeMap={},d.clear(),x.clear(),M.onRelaxed()}},f.onRelaxed=function(){},f.isRunning=function(){return!!this._timer},f.isVisible=function(o){return o.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(o):!0},f.isLayoutable=function(a){if(a.s("layoutable")===!1)return!1;if(a instanceof U)return!1;var $=this;return $.gv?$.gv.isMovable(a)&&!$.gv.isSelected(a):!($.cdm||$.dm).sm().co(a)},f.getNodeRepulsion=function(){return this._nodeRepulsion},f.setNodeRepulsion=function(E){this._nodeRepulsion=E,this._damper=1},f.getEdgeRepulsion=function(){return this._edgeRepulsion},f.setEdgeRepulsion=function(t){this._edgeRepulsion=t,this._damper=1},f.getStepCount=function(){return this._stepCount},f.setStepCount=function(S){this._stepCount=S,this._damper=1},f.getInterval=function(){return this._interval},f.setInterval=function(U){var T=this;T._interval!==U&&(T._interval=U,T._timer&&(clearInterval(T._timer),T._timer=setInterval(function(){T.relax()},U)))},f.handleDataPropertyChange=function(E){!this._isAdjusting&&this.isVisible(E.data)&&(this._damper=1)},f.handleDataModelChange=function(){this._damper=1},f.damp=function(){var j=this._maxMotion,F=this._damper;this._motionRatio<=.001&&((.2>j||j>1&&.9>F)&&F>.01?this._damper-=.01:.4>j&&F>.003?this._damper-=.003:F>1e-4&&(this._damper-=1e-4)),j<this._motionLimit&&(this._damper=0)}}}),G.layout.ForceLayout=function(Y){this.init(Y)},G.Default.def(y+"ForceLayout",t,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(f){this._limitBounds=f,this._damper=1},getNodeSize:function(A){var f=this.gv;return f&&f.getDataUIBounds?f.getDataUIBounds(A):A.getRect()},addNode:function(S){var $=this,K=$._nodeMap[S._id];if(K)return K;var V=S.p();K={v:S,x:V.x,y:V.y,dx:0,dy:0,fix:!$.isLayoutable(S),s:$.getNodeSize(S)};var N=K.s,f=L(B(N.width)+B(N.height))*$._nodeRepulsion;return K.r=1>f?100:f,$._nodeMap[S._id]=K,$._nodes.add(K),K},addEdge:function(v){if(v._40I&&v._41I){var r=this,$=r.addNode(v._40I),H=r.addNode(v._41I),E={s:$,t:H};H=H.s,$=$.s;var X=H.width+$.width,K=H.height+$.height;E.length=L(X*X+K*K)*r._edgeRepulsion,E.length<=0&&(E.length=100),r._edges.add(E)}},relaxEdge:function(E){var w=E.t,C=E.s,j=w.x-C.x,p=w.y-C.y,I=L(j*j+p*p),O=100*E.length,c=.25*j/O*I,J=.25*p/O*I;w.dx=w.dx-c,w.dy=w.dy-J,C.dx=C.dx+c,C.dy=C.dy+J},relaxNode:function(Y,J){if(Y!==J){var K=0,y=0,V=Y.x-J.x,G=Y.y-J.y,f=V*V+G*G;0===f?(K=o(),y=o()):36e4>f&&(K=V/f,y=G/f);var c=Y.r*J.r/400;K*=c,y*=c,Y.dx+=K,Y.dy+=y,J.dx-=K,J.dy-=y}},moveNode:function(){var t=this,o=t._limitBounds,v=t._maxMotion,W=0,$=t._damper;t._nodes.each(function(k){if(!k.fix){var h=k.dx*$,z=k.dy*$;if(k.dx=h/2,k.dy=z/2,W=D(L(h*h+z*z),W),k.x+=D(-40,A(40,h)),k.y+=D(-40,A(40,z)),o){k.x<o.x&&(k.x=o.x,t.adjust(1,0)),k.y<o.y&&(k.y=o.y,t.adjust(0,1));var Z=k.s;k.x+Z.width>o.x+o.width&&(k.x=o.x+o.width-Z.width,t.adjust(-1,0)),k.y+Z.height>o.y+o.height&&(k.y=o.y+o.height-Z.height,t.adjust(0,-1))}}}),t._maxMotion=W,t._motionRatio=W>0?v/W-1:0,t.damp()},adjust:function(O,I){var K=this._limitBounds;this._nodes.each(function(j){O>0?(!K||j.x+j.s.width+O<K.x+K.width)&&(j.x+=O):(!K||j.x+O>K.x)&&(j.x+=O),I>0?(!K||j.y+j.s.height+I<K.y+K.height)&&(j.y+=I):(!K||j.y+I>K.y)&&(j.y+=I)})}});var d=G.layout.Force3dLayout=function(S){this.init(S)};G.Default.def(y+"Force3dLayout",t,{ms_force:1,getNodeSize3d:function(V){return V.s3()},addNode:function(N){var S=this,U=S._nodeMap[N._id];if(U)return U;U={v:N,p:N.p3(),d:[0,0,0],fix:!S.isLayoutable(N),s:S.getNodeSize3d(N)};var L=U.s,F=G.Default.getDistance(L)*S._nodeRepulsion;return U.r=1>F?100:F,S._nodeMap[N._id]=U,S._nodes.add(U),U},addEdge:function(E){if(E._40I&&E._41I){var l=this,K=l.addNode(E._40I),x=l.addNode(E._41I),z={s:K,t:x};x=x.s,K=K.s,z.length=L(B(x[0]+K[0])+B(x[1]+K[1])+B(x[2]+K[2]))*l._edgeRepulsion,z.length<=0&&(z.length=100),l._edges.add(z)}},relaxEdge:function(m){var s=m.t.p,R=m.s.p,W=m.t.d,p=m.s.d,_=s[0]-R[0],n=s[1]-R[1],z=s[2]-R[2],f=L(_*_+n*n+z*z),w=100*m.length,Q=.25*_/w*f,E=.25*n/w*f,b=.25*z/w*f;W[0]-=Q,W[1]-=E,W[2]-=b,p[0]+=Q,p[1]+=E,p[2]+=b},relaxNode:function(l,b){if(l!==b){var n=l.p,Y=b.p,Z=0,I=0,w=0,h=n[0]-Y[0],R=n[1]-Y[1],x=n[2]-Y[2],m=h*h+R*R+x*x;0===m?(Z=o(),I=o(),w=o()):216e6>m&&(Z=h/m,I=R/m,w=x/m);var X=l.r*b.r/400,U=l.d,k=b.d;Z*=X,I*=X,w*=X,U[0]+=Z,U[1]+=I,U[2]+=w,k[0]-=Z,k[1]-=I,k[2]-=w}},moveNode:function(){var J=this,z=J._maxMotion,Q=0,Y=J._damper;J._nodes.each(function(P){if(!P.fix){var k=P.p,G=P.d,B=G[0]*Y,u=G[1]*Y,a=G[2]*Y;G[0]=B/2,G[1]=u/2,G[2]=a/2,Q=D(L(B*B+u*u+a*a),Q),k[0]+=D(-40,A(40,B)),k[1]+=D(-40,A(40,u)),k[2]+=D(-40,A(40,a))}}),J._maxMotion=Q,J._motionRatio=Q>0?z/Q-1:0,J.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:this,Object);